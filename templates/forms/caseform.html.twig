{% import _self as formMacros %}

{% macro makePersonForm(personRow, gridForm = 0) %}
    {% if gridForm == 1 %}
            <div class="card-header">
                Additional Person
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        {{ form_row(personRow.name) }}
                    </div>
                    <div class="col">
                        {{ form_row(personRow.role) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-8">
                        {{ form_row(personRow.traits) }}
                    </div>
                    <div class="col-4">
                        <div class="btn btn-danger remove-case-btn">Remove</div>
                    </div>
                </div>
            </div>
    {% else %}
        <div class="person-form card">
            <div class="card-header">
                Primary Person
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        {{ form_row(personRow.name) }}
                    </div>
                    <div class="col">
                        {{ form_row(personRow.role) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        {{ form_row(personRow.traits) }}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endmacro makePersonForm %}

<div class="form-wrapper">
    <h2>{{ form_title }}</h2>
    <hr>
    {{ form_start(form) }}
        <div class="row">
            <div class="col">
                {{ form_row(form.description) }}
            </div>
            <div class="col">
                {{ form_row(form.date) }}
            </div>
        </div>
        {{ form_row(form.summary) }}
        {{ form_row(form.video) }}

        {{ formMacros.makePersonForm(form.primary_person) }}

        <div class="form-section-header">
            <div class="form-header-logo">
                <h3>Others Involved</h3>
            </div>
            <div class="form-header-options">
                <button id ="addPersonBtn" type="button" class="btn btn-info btn-sm add_person" data-collection-holder-class="associated-persons">Add Person</button>
            </div>
        </div>
        <div id="assocPersonsContainer" class="associated-persons embed-form-grid" data-prototype="{{ formMacros.makePersonForm(form.associated_persons.vars.prototype, 1)|e('html_attr') }}">
            {% for assoc_person in form.associated_persons %}
                {{ formMacros.makePersonForm(assoc_person, 1) }}
            {% endfor %}
        </div>

    {{ form_end(form) }}
</div>
